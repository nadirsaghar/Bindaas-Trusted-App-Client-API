Bindaas Trusted App Client API
==============================


## Trusted Application Framework
Bindaas provides a framework for applications that are "trusted" by Bindaas to tap into Bindaas's internal sescurity system
and manage API Keys. 

Following operations are supported through Trusted Application API :
*  Authorize New User
*  Revoke Access of User
*  Issue Short Lived API Key.

Each Trusted Application is issued the following by the Bindaas's system-administrator :
*  application-id
*  application-secret

Using these two parameters and the cryptographic algorithm described below a Trusted Application asserts it's identity
and message integrity to Bindaas Server.

##### Algorithm :

For each request a psedorandom string - salt is generated by the client. Using the salt,username,application-id and application-secret
a digest is calculated described in the following code snippet :
 
 ``` java
 public static String calculateDigestValue(String applicationID,
			String applicationKey, String salt, String username)
			throws Exception {
		long roundoff = System.currentTimeMillis() / ROUNDOFF_FACTOR;
		String prenonce = roundoff + "|" + applicationKey;
		byte[] nonceBytes = MessageDigest.getInstance("SHA-1").digest(
				prenonce.getBytes("UTF-8"));
		String nonce = DatatypeConverter.printBase64Binary(nonceBytes);

		String predigest = String.format("%s|%s|%s|%s", username, nonce,
				applicationID, salt);
		String digest = DatatypeConverter.printBase64Binary(MessageDigest
				.getInstance("SHA-1").digest(predigest.getBytes("UTF-8")));

		return digest;
	}
 ```
The client sends over `username`,`application-id`,`salt` and the `digest` calculated above to Bindaas. 
Using the same logic Bindaas calculates the digest value and verifies the request.

The digest calclulated above is a function of system time. It's assumed that the sytem clocks of bindaas server and client app are in sync. In theory it is possible to reuse the digest to
perform replay attack. But since it is sensitive to time this attack would only work in a certain time-window which is controlled by `ROUNDOFF_FACTOR`.
Lower `ROUNDOFF_FACTOR` will yeild shortened time-window and better security.


## Command Line Options
```
> java -jar trusted-app-client-0.0.1-jar-with-dependencies.jar [options]

 -action <arg>     Action to be performed. Allowed values are :
                   a - authorize new user
                   r - revoke user
                   i - issue short-lived API Key
 -comments <arg>   comments. Optional
 -expires <arg>    Expiration Date. Must be specified with authorize new
                   user action in mm/dd/yyyy format
 -id <arg>         Application ID
 -lifetime <arg>   lifetime of the short-lived API Key in seconds.
                   Optional
 -secret <arg>     Application Secret
 -url <arg>        Base URL of the service
 -username <arg>   Username
```
#### Authorize New User

```
java -jar trusted-app-client-0.0.1-jar-with-dependencies.jar -action a -username test-user-1 -id demo-id -secret demo-secret-key -comments 'Testing new Account' -expires 12/31/2060 -url http://localhost:9099/trustedApplication
```

#### Revoking User Access

```
java -jar trusted-app-client-0.0.1-jar-with-dependencies.jar -action r -username test-user-1 -id demo-id -secret demo-secret-key  -comments 'Removing new Account' -url http://localhost:9099/trustedApplication
```

#### Issue Short Lived API-Key 
```
java -jar trusted-app-client-0.0.1-jar-with-dependencies.jar -action i -username test-user-1 -id demo-id -secret demo-secret-key -lifetime 36000 -url http://localhost:9099/trustedApplication
```
